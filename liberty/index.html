



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Application Modernization</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.30686662.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#cloudpak-for-applications-runtime-modernization-solution" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Application Modernization" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Application Modernization
            </span>
            <span class="md-header-nav__topic">
              
                Runtime modernization
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ibm-cloud-architecture/cloudpak-for-applications
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Application Modernization" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Application Modernization
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    ibm-cloud-architecture/cloudpak-for-applications
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Runtime modernization
      </label>
    
    <a href="./" title="Runtime modernization" class="md-nav__link md-nav__link--active">
      Runtime modernization
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-overview" class="md-nav__link">
    Application Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-the-application-was-modernized" class="md-nav__link">
    How the Application was Modernized
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" class="md-nav__link">
    Deploy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-application" class="md-nav__link">
    Deploy the Application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-project-repository" class="md-nav__link">
    Getting the project repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-application-database-infrastructure" class="md-nav__link">
    Create application database infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-security-context-constraint" class="md-nav__link">
    Create the Security Context Constraint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-projects" class="md-nav__link">
    Create the projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-account" class="md-nav__link">
    Create a service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-jenkins" class="md-nav__link">
    Deploy Jenkins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-jenkins-service-account" class="md-nav__link">
    Update the Jenkins service account
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-the-deployment-templates" class="md-nav__link">
    Import the deployment templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-deployment-definitions" class="md-nav__link">
    Create the deployment definitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-the-build-templates" class="md-nav__link">
    Import the build templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-build-definitions" class="md-nav__link">
    Create the build definitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-pipeline" class="md-nav__link">
    Run the pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-the-application" class="md-nav__link">
    Validate the Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../spring/" title="Spring modernization" class="md-nav__link">
      Spring modernization
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../was90/" title="Operational modernization" class="md-nav__link">
      Operational modernization
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#application-overview" class="md-nav__link">
    Application Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-the-application-was-modernized" class="md-nav__link">
    How the Application was Modernized
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    Analysis
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build" class="md-nav__link">
    Build
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy" class="md-nav__link">
    Deploy
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-the-application" class="md-nav__link">
    Deploy the Application
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#getting-the-project-repository" class="md-nav__link">
    Getting the project repository
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-application-database-infrastructure" class="md-nav__link">
    Create application database infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-security-context-constraint" class="md-nav__link">
    Create the Security Context Constraint
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-projects" class="md-nav__link">
    Create the projects
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-service-account" class="md-nav__link">
    Create a service account
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-jenkins" class="md-nav__link">
    Deploy Jenkins
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#update-the-jenkins-service-account" class="md-nav__link">
    Update the Jenkins service account
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#import-the-deployment-templates" class="md-nav__link">
    Import the deployment templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-deployment-definitions" class="md-nav__link">
    Create the deployment definitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#import-the-build-templates" class="md-nav__link">
    Import the build templates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-build-definitions" class="md-nav__link">
    Create the build definitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-the-pipeline" class="md-nav__link">
    Run the pipeline
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-the-application" class="md-nav__link">
    Validate the Application
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/edit/master/docs/liberty/README.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="cloudpak-for-applications-runtime-modernization-solution">CloudPak for Applications: Runtime Modernization Solution</h1>
<h2 id="introduction">Introduction</h2>
<p><strong>Runtime modernization</strong> moves an application to a 'built for the cloud' runtime with the least amount of effort. <strong>WebSphere Liberty</strong> is a fast, dynamic, and easy-to-use Java application server, built on the open source Open Liberty project. Ideal or the cloud, Liberty is a combination of IBM technology and open source software, with fast startup times (&lt;2 seconds), no server restarts to pick up changes, and a simple XML configuration.</p>
<p>However, WebSphere Liberty doesn't support all of the legacy Java EE and WebSphere proprietary functionality and some code changes maybe required to move an existing application to the new runtime. Effort is also required to move the application configuration from traditional WebSphere to WebSphere Liberty's XML configuration files.</p>
<p><strong>This path gets the application on to a cloud-ready runtime container which is easy to use and portable. However, the application is mostly unchanged and has not been 'modernized' to a newer architecture such as micro-services</strong>  </p>
<p>Applications deployed on the WebSphere Liberty container runtime can be build, deployed and managed with the same common technologies and methodologies that would be used by cloud-native (built for the cloud) applications.</p>
<p>The diagram below shows the high level decision flow where IBM Cloud Transformation Advisor is used to analyze existing assets and a decision is made to move the monolithic application to the Liberty container.</p>
<p><img alt="Liberty flow" src="images/libertyflow.jpg" /></p>
<p>This repository holds a solution that is the result of a <strong>runtime modernization</strong> for an existing WebSphere Java EE application that was moved from WebSphere ND v8.5.5 to WebSphere Liberty and deployed by the IBM CloudPak for Applications to RedHat OpenShift.</p>
<h2 id="application-overview">Application Overview</h2>
<p>The <strong>Customer Order Services</strong> application is a simple store-front shopping application, built during the early days of the Web 2.0 movement. Users interact directly with a browser-based interface and manage their cart to submit orders.  This application is built using the traditional <a href="http://www.tonymarston.net/php-mysql/3-tier-architecture.html">3-Tier Architecture</a> model, with an HTTP server, an application server, and a supporting database.</p>
<p><img alt="Phase 0 Application Architecture" src="https://github.com/ibm-cloud-architecture/refarch-jee/raw/master/static/imgs/apparch-pc-phase0-customerorderservices.png" /></p>
<p>There are several components of the overall application architecture:</p>
<ul>
<li>Starting with the database, the application leverages two SQL-based databases running on <a href="https://www.ibm.com/analytics/us/en/technology/db2/">IBM DB2</a>.</li>
<li>The application exposes its data model through an <a href="https://en.wikipedia.org/wiki/Enterprise_JavaBeans">Enterprise JavaBean</a> layer, named <strong>CustomerOrderServices</strong>.  This components leverages the <a href="https://en.wikibooks.org/wiki/Java_Persistence/What_is_JPA%3F">Java Persistence API</a> to exposed the backend data model to calling services with minimal coding effort.<ul>
<li>This build of the application uses JavaEE6 features for EJBs and JPA.</li>
</ul>
</li>
<li>The next tier of the application, named <strong>CustomerOrderServicesWeb</strong>, exposes the necessary business APIs via REST-based web services.  This component leverages the <a href="https://en.wikipedia.org/wiki/Java_API_for_RESTful_Web_Services">JAX-RS</a> libraries for creating Java-based REST services with minimal coding effort.<ul>
<li>This build of the application is using <strong>JAX-RS 1.1</strong> version of the respective capability.</li>
</ul>
</li>
<li>The application's user interface is exposed through the <strong>CustomerOrderServicesWeb</strong> component as well, in the form of a <a href="#tbd">Dojo Toolkit</a>-based JavaScript application.  Delivering the user interface and business APIs in the same component is one major inhibitor our migration strategy will help to alleviate in the long-term.</li>
<li>Finally, there is an additional integration testing component, named <strong>CustomerOrderServicesTest</strong> that is built to quickly validate an application's build and deployment to a given application server.  This test component contains both <strong>JPA</strong> and <strong>JAX-RS</strong>-based tests.</li>
</ul>
<h2 id="how-the-application-was-modernized">How the Application was Modernized</h2>
<p>In order to modernize the application from WebSphere ND v8.5.5 to WebSphere Liberty running on OpenShift, the application went through <strong>analysis</strong>, <strong>build</strong> and <strong>deploy</strong> phases.</p>
<h3 id="analysis">Analysis</h3>
<p><a href="https://www.ibm.com/cloud/garage/practices/learn/ibm-transformation-advisor">IBM Cloud Transformation Advisor</a> was used to analyze the existing Customer Order Services application and the WebSphere ND runtime. The steps were:</p>
<ol>
<li>
<p>Install IBM Cloud Transformation Advisor either in to a <a href="https://developer.ibm.com/recipes/tutorials/deploying-transformation-advisor-into-ibm-cloud-private/">Kubernetes Cluster</a> or <a href="https://www.ibm.com/cloud/garage/tutorials/install-ibm-transformation-advisor-local">locally</a></p>
</li>
<li>
<p>Download and execute the <strong>Data Collector</strong> against the existing WebSphere ND runtime</p>
</li>
<li>
<p>Upload the results of the data collection in to IBM Cloud Transformation Advisor and review the analysis. A screenshot of the analysis is shown below:<br />
<img alt="tWAS" src="images/liberty-analyze/analysis1a.jpg" /><br />
  In the case of the <strong>CustomerOrderServicesApp.ear</strong> application, IBM Cloud Transformation Advisor has determined that the migration to WebSphere Liberty on Private Cloud is of <strong>Moderate</strong> complexity and that there are two <strong>Severe Issues</strong> that have been detected.  </p>
</li>
<li>
<p>Drilling down in to <strong>Detailed Migration Analysis Report</strong> that is part of the application analysis, it is apparent that IBM Cloud Transformation Advisor has detected that there are issues with lookups for Enterprise JavaBeans and with accessing the Apache Wink APIs.</p>
</li>
</ol>
<p><img alt="JPA" src="images/liberty-analyze/severe.jpg" /></p>
<p><strong>Behavior change on lookups for Enterprise JavaBeans</strong> In Liberty, EJB components are not bound to a server root Java Naming and Directory Interface (JNDI) namespace as they are in WebSphere Application Server traditional. The fix for this is to change the three classes that use <code>ejblocal</code> to use the correct URL for Liberty</p>
<p><strong>The user of system provided Apache Wink APIs requires configuration</strong> To use system-provided third-party APIs in Liberty applications, you must configure the applications to include the APIs. In WebSphere Application Server traditional, these APIs are available without configuration. This is a configuration only change and can be achieved by using a <code>classloader</code> definition in the Liberty server.xml file.  <br />
5. In summary, some minimal code changes are required to move this application to the WebSphere Liberty runtime and the decision was taken to proceed with these code changes.</p>
<p>Detailed, step-by-step instructions on how to replicate these steps are provided <a href="liberty-analyze/">here</a></p>
<h3 id="build">Build</h3>
<p>The <strong>build</strong> phase made changes to source code and created the WebSphere Liberty configuration artifacts. The steps were:</p>
<ol>
<li>
<p>Make the simple code changes required for the EJB lookups which were recommended by IBM Cloud Transformation Advisor. The three Java classes that should be modified to look up Enterprise JavaBeans differently are shown in the detailed analysis view of IBM Cloud Transformation Advisor:<br />
<img alt="Analysis" src="images/liberty-build/analysis.jpg" /><br />
  Below is an example of the code changes required for one of the three Java classes. The <code>org.pwte.example.resources.CategoryResource.java</code> is changed from using <code>ejblocal</code> on line 28 as shown below:<br />
  Before:<br />
<code>java
  ...
  InitialContext().lookup("ejblocal:org.pwte.example.service.ProductSearchService");
  ...</code><br />
  After:<br />
<code>java
  ...
  InitialContext().lookup("java:app/CustomerOrderServices/ProductSearchServiceImpl!org.pwte.example.service.ProductSearchService");
  ...</code>  </p>
</li>
<li>
<p>The WebSphere Liberty runtime configuration files <code>server.xml</code>, <code>server.env</code> and <code>jvm.options</code> were created from the templates provided by IBM Cloud Transformation Advisor. The final versions of files can be found here:  </p>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/liberty/server.xml">server.xml</a></li>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/liberty/server.env">server.env</a></li>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/liberty/jvm.options">jvm.options</a></li>
</ul>
</li>
<li>
<p>WebSphere Liberty was configured for application monitoring using Prometheus and the Prometheus JMX Exporter. This was necessary to integrate WebSphere Liberty with the RedHat OpenShift monitoring framework.  </p>
</li>
<li>The <code>Dockerfile</code> required to build the <strong>immutable Docker Image</strong> containing the application and WebSphere Liberty was created from the template provided by IBM Cloud Transformation Advisor. The final file can be found here:<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Dockerfile">Dockerfile</a>  </li>
</ul>
</li>
<li>The containerized application was tested locally before the code and configuration files were committed to the <strong>git</strong> repository</li>
</ol>
<p>Detailed, step-by-step instructions on how to replicate these steps are provided <a href="liberty-build/">here</a></p>
<h3 id="deploy">Deploy</h3>
<p>The <strong>deploy</strong> phase created the Jenkins, Kubernetes and RedHat OpenShift artifacts required to automate the build and deployment pipeline for the application. For illustration purposes, the application was deployed to three different RedHat OpenShift projects to simulate <code>development</code>, <code>staging</code> and <code>production</code>. The diagram below shows the flow through the pipeline. A more detailed description can be found <a href="liberty-deploy/">here</a></p>
<p><img alt="Pipeline" src="images/liberty-deploy/overview.jpg" /></p>
<p>The steps were:</p>
<ol>
<li>
<p>Configure the RedHat OpenShift Cluster for WebSphere by creating the necessary <code>SecurityContextConstraints</code> definition. The file can be found here:</p>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/ssc.yaml">scc.yaml</a></li>
</ul>
</li>
<li>
<p>Create the RedHat OpenShift <strong>build template</strong> that would be used to define the RedHat OpenShift artifacts related to the build process including <code>ImageStream</code> and <code>BuildConfig</code> definitions. The file can be found here:</p>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/template-liberty-build.yaml">template-libery-build.yaml</a></li>
</ul>
</li>
<li>
<p>Create the RedHat OpenShift <strong>deployment template</strong> that would be used to define the RedHat OpenShift artifacts related to the Customer Order Services application including <code>DeploymentConfig</code>, <code>Service</code> and <code>Route</code> definitions. The file can be found here:</p>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/template-liberty-deploy.yaml">template-libery-deploy.yaml</a></li>
</ul>
</li>
<li>
<p>Create the Jenkins <code>Jenkinsfile</code> for the pipeline. The Jenkinsfile defines the steps that the pipeline takes to build the Customer Order Services application EAR file, create an immutable Docker Image and then move the image through the <code>dev</code>, <code>stage</code> and <code>prod</code> environments. The file can be found here:</p>
<ul>
<li><a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Jenkinsfile">Jenkinsfile</a></li>
</ul>
</li>
<li>
<p>Create the <code>build</code> project, load the <strong>build template</strong> and configure <strong>Jenkins</strong></p>
</li>
<li>
<p>Create the <code>dev</code>, <code>stage</code> and <code>prod</code> projects and load the <strong>deployment template</strong></p>
</li>
<li>
<p>Verify the pipeline.</p>
</li>
</ol>
<p>Detailed, step-by-step instructions on how to replicate these steps are provided <a href="liberty-deploy/">here</a></p>
<h2 id="deploy-the-application">Deploy the Application</h2>
<p>The following steps will deploy the modernized Customer Order Services application in a WebSphere Liberty container to a RedHat OpenShift cluster.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>You will need the following:</p>
<ul>
<li><a href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git">Git CLI</a></li>
<li>RedHat OpenShift 3.11 with Cluster Admin permissions</li>
<li><a href="https://docs.openshift.com/container-platform/3.11/cli_reference/get_started_cli.html">oc CLI</a></li>
<li>DB2 Database</li>
</ul>
<h3 id="getting-the-project-repository">Getting the project repository</h3>
<p>You can clone the repository from its main GitHub repository page and checkout the appropriate branch for this version of the application.</p>
<div class="codehilite"><pre><span></span><span class="nv">git</span> <span class="nv">clone</span> <span class="nv">https</span>:<span class="o">//</span><span class="nv">github</span>.<span class="nv">com</span><span class="o">/</span><span class="nv">ibm</span><span class="o">-</span><span class="nv">cloud</span><span class="o">-</span><span class="nv">architecture</span><span class="o">/</span><span class="nv">cloudpak</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">applications</span>.<span class="nv">git</span>
<span class="nv">cd</span> <span class="nv">cloudpak</span><span class="o">-</span><span class="k">for</span><span class="o">-</span><span class="nv">applications</span>
<span class="nv">git</span> <span class="nv">checkout</span> <span class="nv">liberty</span>
</pre></div>


<h3 id="create-application-database-infrastructure">Create application database infrastructure</h3>
<p>As said in the prerequisites section above, the Customer Order Services application uses uses DB2 as its database. Follow these steps to create the appropriate database, tables and data the application needs to:</p>
<ol>
<li>
<p>Copy the createOrderDB.sql and initialDataSet.sql files you can find in the Common directory of this repository over to the db2 host machine (or git clone the repository) in order to execute them later.</p>
</li>
<li>
<p>Ssh into the db2 host</p>
</li>
<li>
<p>Change to the db2 instance user: `su {database_instance_name}``</p>
</li>
<li>
<p>Start db2: <code>db2start</code></p>
</li>
<li>
<p>Create the ORDERDB database: <code>db2 create database ORDERDB</code></p>
</li>
<li>
<p>Connect to the ORDERDB database: <code>db2 connect to ORDERDB</code></p>
</li>
<li>
<p>Execute the createOrderDB.sql script you copied over in step 1 in order to create the appropriate tables, relationships, primary keys, etc: <code>db2 -tf createOrderDB.sql</code></p>
</li>
<li>
<p>Execute the initialDataSet.sql script you copied over in step 1 to populate the ORDERDB database with the needed initial data set: <code>db2 -tf initialDataSet.sql</code></p>
</li>
</ol>
<p>If you want to re-run the scripts, please make sure you drop the databases and create them again.</p>
<h3 id="create-the-security-context-constraint">Create the Security Context Constraint</h3>
<p>In order to deploy and run the WebSphere Liberty Docker image in an OpenShift cluster, we first need to configure certain security aspects for the cluster. The <code>Security Context Constraint</code> provided <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/ssc.yaml">here</a> grants the <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">service account</a> that the WebSphere Liberty Docker container is running under the required privileges to function correctly.</p>
<p>A <strong>cluster administrator</strong> can use the file provided <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/ssc.yaml">here</a> with the following command to create the Security Context Constraint (SCC):</p>
<div class="codehilite"><pre><span></span><span class="n">cd</span> <span class="n">Deployment</span><span class="o">/</span><span class="n">OpenShift</span>
<span class="n">oc</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">ssc</span><span class="p">.</span><span class="n">yaml</span>
</pre></div>


<h3 id="create-the-projects">Create the projects</h3>
<p>Four RedHat OpenShift projects are required in this scenario:</p>
<ul>
<li>Build: this project will contain the Jenkins server and the artifacts used to build the application image  </li>
<li>Dev: this is the <code>development</code> environment for this application</li>
<li>Stage: this is the <code>staging</code> environment for this application</li>
<li>Prod: this is the <code>production</code> environment for this application</li>
</ul>
<p>The file provided <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/liberty-projects.yaml">here</a> contains the definitions for the four projects in a single file to make creation easier</p>
<p>Issue the command shown below to create the projects</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="k">create</span> <span class="o">-</span><span class="n">f</span> <span class="n">liberty</span><span class="o">-</span><span class="n">projects</span><span class="p">.</span><span class="n">yaml</span>
</pre></div>


<h3 id="create-a-service-account">Create a service account</h3>
<p>It is a good Kubernetes practice to create a <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/">service account</a> for your applications. A service account provides an identity for processes that run in a Pod. In this step we will create a new service account with the name <code>websphere</code> in each of the <code>dev</code>, <code>stage</code> and <code>prod</code> projects and add the Security Context Constraint created above to them.</p>
<p>Issue the commands shown below to create the <code>websphere</code> service account and bind the ibm-websphere-scc to it in each of the projects:</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="k">create</span> <span class="n">serviceaccount</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">dev</span>
<span class="n">oc</span> <span class="k">create</span> <span class="n">serviceaccount</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">stage</span>
<span class="n">oc</span> <span class="k">create</span> <span class="n">serviceaccount</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">prod</span>
<span class="n">oc</span> <span class="n">adm</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="n">scc</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">ibm</span><span class="o">-</span><span class="n">websphere</span><span class="o">-</span><span class="n">scc</span> <span class="o">-</span><span class="n">z</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">dev</span>
<span class="n">oc</span> <span class="n">adm</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="n">scc</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">ibm</span><span class="o">-</span><span class="n">websphere</span><span class="o">-</span><span class="n">scc</span> <span class="o">-</span><span class="n">z</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">stage</span>
<span class="n">oc</span> <span class="n">adm</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="n">scc</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">ibm</span><span class="o">-</span><span class="n">websphere</span><span class="o">-</span><span class="n">scc</span> <span class="o">-</span><span class="n">z</span> <span class="n">websphere</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">prod</span>
</pre></div>


<h3 id="deploy-jenkins">Deploy Jenkins</h3>
<p>Some RedHat OpenShift clusters are configured to automatically provision a Jenkins instance in a build project. The steps below can be used if your cluster is not configured for automatic Jenkins provisioning:</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="n">project</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span>
<span class="n">oc</span> <span class="k">new</span><span class="o">-</span><span class="n">app</span> <span class="n">jenkins</span><span class="o">-</span><span class="n">persistent</span>
</pre></div>


<h2 id="update-the-jenkins-service-account">Update the Jenkins service account</h2>
<p>During provisioning of the Jenkins master a service account with the name <code>jenkins</code> is created. This service account has privileges to create new artifacts only in the project that it is running in. In this scenario Jenkins will need to create artifacts in the <code>dev</code>, <code>stage</code> and <code>prod</code> projects.</p>
<p>Issue the commands below to allow the <code>jenkins</code> service account to <code>edit</code> artifacts in the <code>dev</code>, <code>stage</code> and <code>prod</code> projects.</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="k">role</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">edit</span> <span class="k">system</span><span class="p">:</span><span class="n">serviceaccount</span><span class="p">:</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span><span class="p">:</span><span class="n">jenkins</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">dev</span>
<span class="n">oc</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="k">role</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">edit</span> <span class="k">system</span><span class="p">:</span><span class="n">serviceaccount</span><span class="p">:</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span><span class="p">:</span><span class="n">jenkins</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">stage</span>
<span class="n">oc</span> <span class="n">policy</span> <span class="k">add</span><span class="o">-</span><span class="k">role</span><span class="o">-</span><span class="k">to</span><span class="o">-</span><span class="k">user</span> <span class="n">edit</span> <span class="k">system</span><span class="p">:</span><span class="n">serviceaccount</span><span class="p">:</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span><span class="p">:</span><span class="n">jenkins</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">prod</span>
</pre></div>


<h3 id="import-the-deployment-templates">Import the deployment templates</h3>
<p>RedHat OpenShift <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/templates.html">templates</a> are used to make artifact creation easier and repeatable. The template definition provided <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/template-liberty-deploy.yaml">here</a> defines a Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/"><code>Service</code></a>, <a href="https://docs.openshift.com/container-platform/3.11/architecture/networking/routes.html"><code>Route</code></a> and <a href="https://docs.openshift.com/container-platform/3.11/architecture/core_concepts/deployments.html#deployments-and-deployment-configurations"><code>DeploymentConfig</code></a> for the CustomerOrderServices application.</p>
<p>The <code>gse-liberty-deploy</code> template defines the following:</p>
<ul>
<li><code>service</code> listening on ports <code>9080</code>, <code>9443</code> and <code>9082</code></li>
<li><code>route</code> to expose the <code>9443</code> port externally</li>
<li><code>DeploymentConfig</code> to host the WebSphere Liberty container.<ul>
<li>The <code>image</code> for the container is taken from the <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/managing_images.html"><code>ImageStream</code></a> that will be populated by the Jenkins pipeline.</li>
<li><code>environment variables</code> are defined for the DB2 database used by the application allowing for environment specific information to be injected</li>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Probes</a> for <code>liveness</code> and <code>readiness</code> are defined to check port 9443 is active</li>
<li>The <code>securityContext</code> is set to allow read/write access to the filesystem and to run the container as <code>user 1001</code></li>
<li>The deployment will be updated if a new image is loaded to the <code>ImageStream</code> or if a change to the configuration is detected.</li>
</ul>
</li>
</ul>
<p>Issue the commands below to load the template named <code>gse-liberty-deploy</code> in the <code>dev</code>, <code>stage</code> and <code>prod</code> projects.</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="k">create</span> <span class="o">-</span><span class="n">f</span> <span class="k">template</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span><span class="p">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">dev</span>
<span class="n">oc</span> <span class="k">create</span> <span class="o">-</span><span class="n">f</span> <span class="k">template</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span><span class="p">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">stage</span>
<span class="n">oc</span> <span class="k">create</span> <span class="o">-</span><span class="n">f</span> <span class="k">template</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span><span class="p">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">prod</span>
</pre></div>


<h3 id="create-the-deployment-definitions">Create the deployment definitions</h3>
<p>In this step the <code>gse-liberty-deploy</code> template will be used to create a RedHat OpenShift <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/application_lifecycle/new_app.html">application</a> named <code>cos-liberty</code> in the <code>dev</code>, <code>stage</code> and <code>prod</code> namespaces.</p>
<p>The result will be:</p>
<ul>
<li><code>service</code> listening on ports <code>9080</code>, <code>9443</code> and <code>9082</code></li>
<li><code>route</code> to expose the <code>9443</code> port externally</li>
<li><code>DeploymentConfig</code> to host the WebSphere Liberty container. The deployment config will wait for a <code>docker image</code> to be loaded in to the <code>ImageStream</code> by the Jenkins pipeline.</li>
</ul>
<p>Issue the following commands to create the applications from the template:</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="k">new</span><span class="o">-</span><span class="n">app</span> <span class="n">gse</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span> <span class="o">-</span><span class="n">p</span> <span class="n">APPLICATION_NAME</span><span class="o">=</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_HOST</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PORT</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_USER</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">user</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PASSWORD</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="n">password</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">dev</span>
<span class="n">oc</span> <span class="k">new</span><span class="o">-</span><span class="n">app</span> <span class="n">gse</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span> <span class="o">-</span><span class="n">p</span> <span class="n">APPLICATION_NAME</span><span class="o">=</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_HOST</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PORT</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_USER</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">user</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PASSWORD</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="n">password</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">stage</span>
<span class="n">oc</span> <span class="k">new</span><span class="o">-</span><span class="n">app</span> <span class="n">gse</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">deploy</span> <span class="o">-</span><span class="n">p</span> <span class="n">APPLICATION_NAME</span><span class="o">=</span><span class="n">cos</span><span class="o">-</span><span class="n">liberty</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_HOST</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PORT</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">host</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_USER</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="k">user</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">p</span> <span class="n">DB2_PASSWORD</span><span class="o">=&lt;</span><span class="n">your</span> <span class="n">DB2</span> <span class="n">password</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">prod</span>
</pre></div>


<h3 id="import-the-build-templates">Import the build templates</h3>
<p>In this step a template for the <code>build</code> process will be loaded in to the <code>build</code> project. The template provided <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/blob/liberty/Deployment/OpenShift/template-liberty-build.yaml">here</a> defines the following artifacts:</p>
<ul>
<li>An <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/managing_images.html">ImageStream</a> for the application image. This will be populated by the Jenkins Pipeline</li>
<li>An ImageStream for WebSphere Liberty which will pull down the latest version of the <code>ibmcom/websphere-liberty:kernel-ubi-min</code> image and will monitor DockerHub for any updates.</li>
<li>A <code>binary</code> <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/builds/build_strategies.html">BuildConfig</a> that will be used by the Jenkins Pipeline to build the application Docker image</li>
<li>A <code>jenkinsfile</code> BuildConfig that defines the <code>Pipeline</code> using the <code>Jenkinsfile</code> in GitHub</li>
<li>Parameters to allow the WebSphere Liberty image and GitHub repository to be provided when the template is instantiated</li>
</ul>
<p>Issue the commands below to load the template named <code>gse-liberty-build</code> in the <code>build</code> projects.</p>
<div class="codehilite"><pre><span></span><span class="n">oc</span> <span class="k">create</span> <span class="o">-</span><span class="n">f</span> <span class="k">template</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span><span class="p">.</span><span class="n">yaml</span> <span class="o">-</span><span class="n">n</span> <span class="n">cos</span><span class="o">-</span><span class="n">liberty</span><span class="o">-</span><span class="n">build</span>
</pre></div>


<h3 id="create-the-build-definitions">Create the build definitions</h3>
<p>In this step the <code>gse-liberty-build</code> template will be used to create a RedHat OpenShift <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/application_lifecycle/new_app.html">application</a> named <code>cos-liberty</code> in the <code>build</code> namespaces.</p>
<p>The result will be:</p>
<ul>
<li>An <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/managing_images.html">ImageStream</a> for the application image. This will be populated by the Jenkins Pipeline</li>
<li>An ImageStream for WebSphere Liberty which will pull down the latest version of the <code>ibmcom/websphere-liberty:kernel-ubi-min</code> image and will monitor DockerHub for any updates.</li>
<li>A <code>binary</code> <a href="https://docs.openshift.com/container-platform/3.11/dev_guide/builds/build_strategies.html">BuildConfig</a> that will be used by the Jenkins Pipeline to build the application Docker image</li>
<li>A <code>jenkinsfile</code> BuildConfig that defines the <code>Pipeline</code> using the <code>Jenkinsfile</code> in GitHub (with the URL provided as a parameter when the application is created)</li>
</ul>
<p>Issue the following commands to create the application from the template:</p>
<div class="codehilite"><pre><span></span><span class="nv">oc</span> <span class="nv">new</span><span class="o">-</span><span class="nv">app</span> <span class="nv">gse</span><span class="o">-</span><span class="nv">liberty</span><span class="o">-</span><span class="nv">build</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">APPLICATION_NAME</span><span class="o">=</span><span class="nv">cos</span><span class="o">-</span><span class="nv">liberty</span> <span class="o">-</span><span class="nv">p</span> <span class="nv">SOURCE_URL</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">https://github.com/ibm-cloud-architecture/cloudpak-for-applications</span><span class="s2">&quot;</span> <span class="o">-</span><span class="nv">n</span> <span class="nv">cos</span><span class="o">-</span><span class="nv">liberty</span><span class="o">-</span><span class="nv">build</span>
</pre></div>


<h3 id="run-the-pipeline">Run the pipeline</h3>
<p>The newly created pipeline can be started from the RedHat OpenShift console which allows access to the Jenkins logs but also tracks the progress in the OCP console.</p>
<ol>
<li>Navigate to <strong>Application Console --&gt; Customer Order Services on Liberty - Build --&gt; Builds --&gt; Pipelines</strong> and click the <strong>Start Pipeline</strong> button</li>
</ol>
<p><img alt="Run Pipeline" src="images/liberty-deploy/run-pipeline.jpg" />
2. When the pipeline starts, click the <code>view log</code> link to go to the Jenkins administration console. Note that it may take a couple of minutes before the <code>view log</code> link appears on the first pipeline build</p>
<p><img alt="View Log" src="images/liberty-deploy/view-log.jpg" /><br />
3. When prompted, log in with your OpenShift account and grant the required access permissions. The Jenkins console log will be displayed as shown below:</p>
<p><img alt="Jenkins Log" src="images/liberty-deploy/jenkins-log.jpg" />
4. Return to the OpenShift Console and track the progress of the pipeline</p>
<p><img alt="Running" src="images/liberty-deploy/pipeline-running.jpg" /><br />
5. The pipeline will eventually stop at the <strong>Promotion Gate</strong> for approval to deploy to Production. Click the <strong>Input Required</strong> link as shown below</p>
<p><img alt="Gate" src="images/liberty-deploy/gate.jpg" /><br />
6. When the <em>Promote application to Production</em> question is displayed, click <strong>Proceed</strong></p>
<p><img alt="Promote" src="../was90/images/twas-deploy/promote.jpg" /><br />
7. Return to the OpenShift Console and validate that the pipeline is now complete</p>
<p><img alt="Complete" src="images/liberty-deploy/complete.jpg" />  </p>
<h2 id="validate-the-application">Validate the Application</h2>
<p>Now that the pipeline is complete, validate the Customer Order Services application is deployed and running in <code>dev</code>, <code>stage</code> and <code>prod</code></p>
<ol>
<li>
<p>In the OpenShift Console, navigate to <strong>Application Console --&gt; Customer Order Services on Liberty - Dev --&gt; Applications --&gt; Deployments</strong> and click on the link in the <strong>Latest Version</strong> column<br />
<img alt="Deployment" src="images/liberty-deploy/deployment.jpg" /></p>
</li>
<li>
<p>Information about the deployment will be displayed including the <strong>image</strong> that is being used (note the <strong>tag</strong> on the image as it will be the same in the <code>stage</code> and <code>prod</code> deployments). After a few minutes the container will be marked as <strong>ready</strong><br />
<img alt="Pods" src="images/liberty-deploy/pods.jpg" /></p>
</li>
<li>
<p>Click <strong>Applications --&gt; Routes</strong> and click on the <strong>route</strong> for the application. Note that the URL is &lt; application_name &gt;-&lt; project_name &gt;.&lt; ocp cluster url &gt;. In this case the project name is <code>cos-liberty-dev</code><br />
<img alt="Route" src="images/liberty-deploy/route.jpg" /></p>
</li>
<li>
<p>Add <code>/CustomerOrderServicesWeb</code> to the end of the URL in the browser to access the application<br />
<img alt="Dev Running" src="images/liberty-deploy/dev-running.jpg" /></p>
</li>
<li>
<p>Log in to the application with <code>username: rbarcia</code> and <code>password: bl0wfish</code></p>
</li>
<li>
<p>Repeat the validations for the <code>stage</code> and <code>prod</code> Projects.</p>
</li>
</ol>
<h2 id="summary">Summary</h2>
<p>This application has been modified from the initial <a href="https://github.com/ibm-cloud-architecture/cloudpak-for-applications/tree/was855">WebSphere ND v8.5.5 version</a> to run on WebSphere Liberty and deployed by the IBM CloudPak for Applications.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href=".." title="Introduction" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </span>
            </div>
          </a>
        
        
          <a href="../spring/" title="Spring modernization" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Spring modernization
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>